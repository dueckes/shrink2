<ul id="<%= dom_id(package) %>_children">
  <% package.children.each do |child_package| -%>
    <% if feature && child_package.in_tree_path_until?(feature.package) -%>
      <%= render :partial => "packages/show_expanded", :locals => { :package => child_package, :feature => feature } %>
    <% else -%>
      <%= render :partial => "packages/show_collapsed", :locals => { :package => child_package } %>
    <% end -%>
  <% end -%>
  <li id="<%= nested_dom_id(:new_package, package) %>" style="display: none;">
  </li>
  <%= render :partial => "features/list", :locals => { :package => package } %>
</ul>
